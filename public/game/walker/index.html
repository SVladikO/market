<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Walker</title>
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
<div>
    <canvas id="canvas" width="1000" height="600" style="border:1px solid #000000;">
    </canvas>
</div>

<div>
    <button onclick="changeStyleToWinter()">winter</button>
    <button onclick="changeStyleToSummer()">summer</button>
    <button onclick="changeStyleToSpring()">spring</button>
</div>


<script src="./script/calculation.js"></script>
<script src="./script/global_var.js"></script>
<script src="./script/render.js"></script>
<script src="./script/style.js"></script>
<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");



    setInterval(() => {
        const intervalId = setInterval(() => {
            const bullet = getCartridge(ganster1X, ganster1Y, ganster1Angle);
            weapon.cartrigesMove.push(bullet)

            const bullet2 = getCartridge(ganster2X, ganster2Y, ganster2Angle);
            weapon.cartrigesMove.push(bullet2)
        }, 300)

        setTimeout(() => {
            clearInterval(intervalId)
        }, 1000)
    }, 4000)

    function drawAll() {
        clearCanvas();
        prepareCanvas();
        renderRectangles()

        weapon.cartrigesMove.forEach(updateBulletData);
        weapon.cartrigesMove.forEach(renderBullet);
        weapon.cartrigesMove = weapon.cartrigesMove.filter(bullet => !bullet.isDead);

        user.angle = getRadianAngle(user.x, mousePositionX, user.y, mousePositionY)
        ganster1Angle = getRadianAngle(ganster1X, user.x, ganster1Y, user.y)
        ganster2Angle = getRadianAngle(ganster2X, user.x, ganster2Y, user.y)

        renderUnit(user.x, user.y);
        renderUnitDirection(user.x, user.y, user.angle);

        renderUnit(ganster1X, ganster1Y);
        renderUnitDirection(ganster1X, ganster1Y, ganster1Angle);

        renderUnit(ganster2X, ganster2Y);
        renderUnitDirection(ganster2X, ganster2Y, ganster2Angle);

        renderLine();
    }

    window.addEventListener("click", (event) => {
        shoot(' ')
    });
    window.addEventListener("keypress", (event) => {
        enableMove(event.key)
        shoot(event.key)

        drawAll();
    });
    window.addEventListener("keyup", (event) => {
        disableMove(event.key);
    });
    window.addEventListener("mousemove", (event) => {
        mousePositionX = event.clientX
        mousePositionY = event.clientY
    });

    function loop() {
        changeUserCoordinates()
        drawAll();
        window.requestAnimationFrame(loop);
    }

    loop();

</script>
</body>
</html>