<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Walker</title>
    <style>
        * {
            font-family: Arial;
            padding: 0;
            margin: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        canvas {
            cursor: cell;
        }

        .guns > img {
            height: 80px;
            border: solid 1px black;
            margin: 10px;
        }

        .wrapper {
            display: flex;

        }

        #notification {
            display: none;
            position: absolute;
            top: 0;
            border: solid 1px red;
            width: 1000px;
            height: 600px;
            background: #ff0000e3;
            justify-content: center;
            align-items: center;
        }
        #alert_notification {
            color: red;
        }

        .themes {
            padding: 10px;
        }
        .themes > button {
            font-size: 30px;
            padding: 4px 8px;
            margin: 4px;
        }
    </style>
</head>
<body>
<div class="wrapper">
    <div class="board">
        <canvas id="canvas" width="1000" height="600" style="border:1px solid #000000;"></canvas>
        <h1 id="notification"></h1>
        <h1 id="alert_notification"></h1>
    </div>
    <div class="control_panel">
        <h1 id="health" class="themes"></h1>
        <div class="guns themes">
            <h1>Available guns:</h1>
            <img onclick="updateWeapon('weapon_gun1')" src="./public/img/gun1.jpeg" alt="">
            <img onclick="updateWeapon('weapon_gun2')" src="./public/img/gun2.png" alt="">
            <img onclick="updateWeapon('weapon_gun3')" src="./public/img/gun3.jpeg" alt="">
        </div>
        <div class="themes">
            <h1>Themes:</h1>
            <button onclick="changeStyleToWinter()">winter</button>
            <button onclick="changeStyleToSummer()">summer</button>
            <button onclick="changeStyleToSpring()">spring</button>
        </div>

        <div class="themes">
            <h1>Sound control:</h1>
            <button onclick="mute()">Mute</button>
            <button onclick="unmute()">Unmute</button>
        </div>
        <div class="themes">
            <h1>Levels:</h1>
            <button onclick="changeLevel(0)">1</button>
            <button onclick="changeLevel(1)">2</button>
            <button onclick="changeLevel(2)">3</button>
            <button onclick="changeLevel(3)">4</button>
            <button onclick="changeLevel(4)">5</button>
            <button onclick="changeLevel(5)">6</button>
            <button onclick="changeLevel(6)">7</button>
            <button onclick="changeLevel(7)">8</button>
            <button onclick="changeLevel(8)">9</button>
            <button onclick="changeLevel(9)">10</button>
        </div>
    </div>
</div>
<img id="userIconId1" src="./public/img/user-icon-5.webp" alt="The Scream" width="220" height="277">
<img id="monsterIconId1" src="./public/img/monster6.png" alt="monster1" width="220" height="277">
<img id="monsterIconId2" src="./public/img/monster2.png" alt="monster2" width="220" height="277">
<img id="monsterIconId3" src="./public/img/monster3.png" alt="monster3" width="220" height="277">
<img id="gunIconId1" src="./public/img/pistol.webp" alt="gun1" width="220" height="277">
<img id="gunIconId2" src="./public/img/ak.webp" alt="gun2" width="220" height="277">
<img id="gunIconId3" src="./public/img/gun.webp" alt="gun3" width="220" height="277">


<!--SCRIPTS-->

<script src="./script/calculation.js"></script>
<script src="./script/entity.js"></script>
<script src="./script/global_var.js"></script>
<script src="./script/render.js"></script>
<script src="./script/style.js"></script>

<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");


    let isMute = true;

    function mute() {
        isMute = true;
    }

    function unmute() {
        isMute = false;
    }
    function updateWeapon(n) {
        const weapons = {
            weapon_gun1,
            weapon_gun2,
            weapon_gun3,
        }

        user.weapon = weapons[n]
    }

    function drawAll() {
        clearCanvas();
        prepareCanvas();
        renderRectangles()

        health.textContent = 'Health: ' + user.health + ' / Bullets amount: ' + user.weapon.bulletAmount

        flyBullets.forEach(bullet => bullet.move());
        flyBullets.forEach(bullet => bullet.render());
        flyBullets = flyBullets.filter(bullet => !bullet.isDead);

        user.render(mousePositionX, mousePositionY);
        units
            // .filter(unit => user.isVisibleForMe(unit.x, unit.y))
            .forEach(unit => unit.render(user.x, user.y))

        units = units.filter(unit => unit.isAlive())

        if (!user.isAlive()) {
            notification.textContent = 'GAME OVER';
            notification.style.display = 'flex';
        }

        renderEnd(finishCoordinates)

        // renderLine();
    }

    function renderEnd(c) {
        ctx.beginPath();
        ctx.font = "30px Arial";
        ctx.fillText('FINISH', c.x, c.y);
    }

    canvas.addEventListener("click", (event) => {
        user.shoot()
        console.log('click', event.clientX, event.clientY)
    });

    window.addEventListener("keypress", (event) => {
        user.enableMove(event.key)
        event.key === ' ' && user.reloadGun()

        drawAll();
    });
    window.addEventListener("keyup", (event) => {
        user.disableMove(event.key);

    });
    window.addEventListener("mousemove", (event) => {
        mousePositionX = event.clientX
        mousePositionY = event.clientY
    });

    function loop() {
        user.move();
        drawAll();
        window.requestAnimationFrame(loop);
    }

    loop();


    setInterval(() => {
        const intervalId = setInterval(() => {
            units.forEach(unit => {
                unit.reloadGun();
                if (unit.isVisibleForMe(user.x, user.y)) {
                    unit.shoot()
                } else {
                    console.log('invisible')
                }
            })

        }, 200)

        setTimeout(() => {
            clearInterval(intervalId)
        }, 1000)
    }, 2000)


</script>
</body>
</html>